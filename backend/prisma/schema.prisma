// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}


// ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¢ãƒ‡ãƒ«
// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¸Šã®ãƒ†ãƒ¼ãƒ–ãƒ«åã¯ "users" ã«ãªã‚Šã¾ã™
model User {
  id                String   @id @default(uuid()) // UUIDã‚’ä¸»ã‚­ãƒ¼ã¨ã—ã¦ä½¿ç”¨
  createdAt         DateTime @default(now())      @map("created_at") // ä½œæˆæ—¥æ™‚
  updatedAt         DateTime @updatedAt           @map("updated_at") // æ›´æ–°æ—¥æ™‚

  username          String   @unique              // ãƒ­ã‚°ã‚¤ãƒ³IDï¼ˆãƒ¦ãƒ‹ãƒ¼ã‚¯ï¼‰
  displayName       String                        @map("display_name") // ç”»é¢è¡¨ç¤ºå
  password          String                        // ãƒãƒƒã‚·ãƒ¥åŒ–ã•ã‚ŒãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
  storeCode         String                        @map("store_code")   // æ‰€å±åº—èˆ—ã‚³ãƒ¼ãƒ‰
  profileImageUrl   String?                       @map("profile_image_url") // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒã®URL (ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«)
  interestedCategories String? @default("[]")

  // ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
  posts             Post[]                        // ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä½œæˆã—ãŸæŠ•ç¨¿
  comments          Comment[]                     // ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä½œæˆã—ãŸã‚³ãƒ¡ãƒ³ãƒˆ

  // ğŸ’¡ User ãŒã©ã®ã€Œã„ã„ã­ã€ã‚’ã—ãŸã‹
  likes     Like[]

  followedBy      Follow[] @relation("followedBy")  // è‡ªåˆ†ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ã„ã‚‹äºº (ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼)
  following       Follow[] @relation("following")   // è‡ªåˆ†ãŒãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ã„ã‚‹äºº (ãƒ•ã‚©ãƒ­ãƒ¼ä¸­)

  @@map("users") // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¸Šã®ãƒ†ãƒ¼ãƒ–ãƒ«åã‚’æ˜ç¤ºçš„ã« "users" ã«è¨­å®š
}

// æŠ•ç¨¿ãƒ¢ãƒ‡ãƒ«
// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¸Šã®ãƒ†ãƒ¼ãƒ–ãƒ«åã¯ "posts" ã«ãªã‚Šã¾ã™
model Post {
  id        String   @id @default(uuid()) // UUIDã‚’ä¸»ã‚­ãƒ¼ã¨ã—ã¦ä½¿ç”¨
  createdAt DateTime @default(now())      @map("created_at") // ä½œæˆæ—¥æ™‚
  updatedAt DateTime @updatedAt           @map("updated_at") // æ›´æ–°æ—¥æ™‚

  title     String?                       // æŠ•ç¨¿ã‚¿ã‚¤ãƒˆãƒ« (ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«)
  content   String                        // æŠ•ç¨¿æœ¬æ–‡

  // ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
  authorId  String                        @map("author_id") // æŠ•ç¨¿ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ID
  author    User     @relation(fields: [authorId], references: [id]) // æŠ•ç¨¿è€…ã¸ã®ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
  imageUrl    String?
  category  String   @default("ãã®ä»–")

  postType  String   @default("INDIVIDUAL") @map("post_type")

  comments  Comment[]                     // ã“ã®æŠ•ç¨¿ã«ä»˜ã‘ã‚‰ã‚ŒãŸã‚³ãƒ¡ãƒ³ãƒˆ

  // ğŸ’¡ post ãŒã©ã®ã€Œã„ã„ã­ã€ã‚’ã—ãŸã‹
  likes     Like[]
  

  @@map("posts") // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¸Šã®ãƒ†ãƒ¼ãƒ–ãƒ«åã‚’æ˜ç¤ºçš„ã« "posts" ã«è¨­å®š
}

// ã‚³ãƒ¡ãƒ³ãƒˆãƒ¢ãƒ‡ãƒ«
// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¸Šã®ãƒ†ãƒ¼ãƒ–ãƒ«åã¯ "comments" ã«ãªã‚Šã¾ã™
model Comment {
  id        String   @id @default(uuid()) // UUIDã‚’ä¸»ã‚­ãƒ¼ã¨ã—ã¦ä½¿ç”¨
  createdAt DateTime @default(now())      @map("created_at") // ä½œæˆæ—¥æ™‚
  updatedAt DateTime @updatedAt           @map("updated_at") // æ›´æ–°æ—¥æ™‚

  content   String                        // ã‚³ãƒ¡ãƒ³ãƒˆæœ¬æ–‡

  // ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ (èª°ãŒã©ã®æŠ•ç¨¿ã«ã‚³ãƒ¡ãƒ³ãƒˆã—ãŸã‹)
  authorId  String                        @map("author_id") // ã‚³ãƒ¡ãƒ³ãƒˆã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ID
  author    User     @relation(fields: [authorId], references: [id]) // ã‚³ãƒ¡ãƒ³ãƒˆæŠ•ç¨¿è€…ã¸ã®ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

  postId    String                        @map("post_id")   // ã‚³ãƒ¡ãƒ³ãƒˆå…ˆã®æŠ•ç¨¿ID
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@map("comments") // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¸Šã®ãƒ†ãƒ¼ãƒ–ãƒ«åã‚’æ˜ç¤ºçš„ã« "comments" ã«è¨­å®š
}

model Like {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now()) @map("created_at")

  // ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ (èª°ãŒã©ã®æŠ•ç¨¿ã«ã„ã„ã­ã—ãŸã‹)
  userId    String   @map("user_id")
  user      User     @relation(fields: [userId], references: [id])

  postId    String   @map("post_id")
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)

  // ğŸ’¡ åŒã˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒåŒã˜æŠ•ç¨¿ã«1å›ã—ã‹ã€Œã„ã„ã­ã€ã§ããªã„ã‚ˆã†ã«ã€
  // ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã¨æŠ•ç¨¿IDã®çµ„ã¿åˆã‚ã›ã‚’ãƒ¦ãƒ‹ãƒ¼ã‚¯ï¼ˆä¸€æ„ï¼‰ã«ã—ã¾ã™
  @@unique([userId, postId])
  @@map("likes")
}

// ğŸ’¡ ãƒ•ã‚©ãƒ­ãƒ¼ãƒ¢ãƒ‡ãƒ«ã‚’è¿½åŠ 
model Follow {
  followerId  String
  follower    User   @relation("following", fields: [followerId], references: [id])

  followingId String
  following   User   @relation("followedBy", fields: [followingId], references: [id])

  createdAt   DateTime @default(now())

  // è¤‡åˆä¸»ã‚­ãƒ¼: åŒã˜ãƒšã‚¢ã®ãƒ•ã‚©ãƒ­ãƒ¼ã¯1å›ã ã‘
  @@id([followerId, followingId])
  @@map("follows")
}